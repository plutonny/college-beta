<!DOCTYPE html>
<html lang="ru">
    <head>
        <meta                                       charset="UTF-8">
        <meta   http-equiv="Permissions-Policy"     content="interest-cohort=()">
        <meta   name="viewport"                     content="width=device-width, initial-scale=1.0">
        <meta   name="author"                       content="Plutonny">
        <meta   name="description"                  content="Ошибка">
        <meta   name="theme-color" id="theme-color" content="#202020">

        <title  id="csc11-title-of-page"            >Ошибка :(</title>

        <script type="text/javascript"              src="https://bebrarium.plutonny.ru/luxon.js"></script>
        <script type="text/javascript"              src="//cdn.jsdelivr.net/npm/eruda"></script>

        <link   rel="icon"                          href="/assets/settings.png">
        <link   rel="manifest"                      href="/college-beta/manifest.json">
        <link   rel="preload prefetch stylesheet"   href="/assets/beta/main.css" as="style">
        <script type="text/javascript"              src="/assets/beta/plutonny.js"></script>
        <script type="text/javascript"              src="/assets/beta/preload.js"></script>
    </head>
    <body>
        <div class="modal" id="modal"></div>

        <div id="error" style="margin-left: 16px; margin-right: 16px;">
            <style>
                .error { margin: 24px; padding-bottom: 80px; }
                p, a, b, h1, h2, h3, h4, h5, h6, button { font-family: 'Montserrat'; }
            </style>
            <h1 style="text-align: center; padding: 42px;">Ошибка!</h1>
            <p style="text-align: center;">Что случилось? Эта ошибка означает, что страница никак не смогла загрузиться.</p>
            <p style="padding-top: 36px;">Что делать? Можете написать разработчику.</p>
            <div style="display: flex; flex-direction: row; flex-wrap: nowrap; align-items: center; border-radius: 16px; padding: 8px; margin-top: 24px; background-color: #ff000050; fill: currentColor;">
                <p style="margin: 2px 4px; font-size: 15px;">Одна из вероятных проблем: не переустановленное приложение. Если Вы его переустановили и вновь увидели эту ошибку, то переустановите еще раз, но перед этим еще очистите кэш браузера.</p>
                <div style="width: 48px; padding: 0px 4px;"><svg style="color: #bd0000a8;" xmlns="http://www.w3.org/2000/svg" height="48" width="48"><path d="M24.2 34.4Q24.95 34.4 25.475 33.875Q26 33.35 26 32.55V23.75Q26 23.05 25.45 22.525Q24.9 22 24.2 22Q23.4 22 22.875 22.525Q22.35 23.05 22.35 23.8V32.6Q22.35 33.35 22.9 33.875Q23.45 34.4 24.2 34.4ZM24 17.9Q24.8 17.9 25.35 17.375Q25.9 16.85 25.9 16.05Q25.9 15.2 25.35 14.65Q24.8 14.1 24 14.1Q23.15 14.1 22.625 14.65Q22.1 15.2 22.1 16.05Q22.1 16.85 22.65 17.375Q23.2 17.9 24 17.9ZM24 44.8Q19.6 44.8 15.8 43.2Q12 41.6 9.2 38.8Q6.4 36 4.8 32.2Q3.2 28.4 3.2 24Q3.2 19.6 4.8 15.8Q6.4 12 9.2 9.2Q12 6.4 15.8 4.8Q19.6 3.2 24 3.2Q28.4 3.2 32.2 4.8Q36 6.4 38.8 9.2Q41.6 12 43.2 15.8Q44.8 19.6 44.8 24Q44.8 28.4 43.2 32.2Q41.6 36 38.8 38.8Q36 41.6 32.2 43.2Q28.4 44.8 24 44.8Z"/></svg></div>
            </div>
            <p>Для опытных пользователей: можно полностью сбросить настройки, это поможет, если проблема со стороны браузера (а проблема скорее всего именно со стороны браузера)</p>
            <div style="display: flex; align-items: center; justify-content: center; flex-wrap: wrap; margin-top: 12px; margin-bottom: 64px;">
                <script>
                    function DELETEALL() {
                        try {
                            localStorage.clear()
                            sessionStorage.clear()
                            caches.delete('csc11-byPlutonny')
                            caches.delete('plutonny-college')
                            document.getElementById('error').innerHTML = `
                            <style>
                                .error { margin: 24px; padding-bottom: 80px; }
                                p, a, b, h1, h2, h3, h4, h5, h6, button { font-family: 'Montserrat'; }
                            </style>
                            <h1 style="text-align: center; padding: 42px;">Успешно!</h1>
                            <p style="text-align: center;">Теперь можно перезагрузить страницу.</p>
                            `
                        } catch (e) {
                            document.getElementById('error').innerHTML = `
                            <style>
                                .error { margin: 24px; padding-bottom: 80px; }
                                p, a, b, h1, h2, h3, h4, h5, h6, button { font-family: 'Montserrat'; }
                            </style>
                            <h1 style="text-align: center; padding: 42px;">Не успешно!</h1>
                            <p style="text-align: center;">Прозошла ошибка при сбросе: ${e}</p>
                            `
                        }
                        
                    }
                </script>
                <button style="height: 48px; width: 256px; margin: 8px; border: none; border-radius: 100px; cursor: pointer;" onclick="DELETEALL()">Сбросить настройки</button>
            </div>
            
            <script>
                /**
                 *  Output modal with additional info in error page
                 */
                function allInfoErrorModal(selfError) {
                    var listLocalStrage =  '';
                    for (var i = 0; i < localStorage.length; i++) { listLocalStrage += `<p style="font-family: 'Montserrat' !important; background-color: #00000020; border-radius: 12px; padding: 4px 8px; margin: 4px; font-size: 14px;">${localStorage.key(i)} - ${localStorage.getItem(localStorage.key(i))}</p>`  }
                    modal(`
                    <div style="max-height: 95%; overflow-y: auto; margin-right: 5%; margin-left: 5%; padding-right: 12px; padding-left: 12px; background-color: var(--primary-bg-color); border: none; border-radius: 24px; box-shadow: 0px 0px 8px var(--navbar-box-color);">

                        <h2 style="font-family: 'Montserrat' !important; text-align: center; margin: 16px 6px; background-color: #ff000070; border-radius: 12px; padding: 6px;">${selfError}</h2>

                        <p style="font-family: 'Montserrat' !important; margin:16px; text-align: center; font-size: 20px;">Ключи localStorage:</p>
                        <div style="display: flex; flex-direction: row; flex-wrap: wrap; justify-content: center;">${listLocalStrage}</div>

                        <div style="display:flex;justify-content:center;">
                            <button style="font-family: 'Montserrat' !important; cursor: pointer; border: none; border-radius: 24px; height: 36px; font-size: 17px; width: 256px; margin: 4px 16px 16px 16px;" onclick="document.getElementById('modal').innerHTML = ''">Закрыть</button>
                        </div>
                    </div>
                `)
                }

                function DELETEALL() {
                    try {
                        localStorage.clear()
                        sessionStorage.clear()
                        caches.delete('csc11-byPlutonny')
                        caches.delete('plutonny-college')
                        document.body.innerHTML = `
                        <style>
                            body { margin: 24px; padding-bottom: 80px; }
                            p, a, b, h1, h2, h3, h4, h5, h6, button { font-family: 'Montserrat'; }
                        </style>
                        <h1 style="text-align: center; padding: 42px;">Успешно!</h1>
                        <p style="text-align: center;">Теперь можно перезагрузить страницу.</p>
                        `
                    } catch (e) {
                        document.body.innerHTML = `
                        <style>
                            body { margin: 24px; padding-bottom: 80px; }
                            p, a, b, h1, h2, h3, h4, h5, h6, button { font-family: 'Montserrat'; }
                        </style>
                        <h1 style="text-align: center; padding: 42px;">Не успешно!</h1>
                        <p style="text-align: center;">Прозошла ошибка при сбросе: ${e}</p>
                        `
                    }
                    
                }

                if (REQUEST.err == 'not_found_table') {
                    plutonny.output('error', `
                        <style>
                            :root {
                                --root-text-color      :#000000;
                                --active-text-color    :#202020;
                                --primary-bg-color     :#f4f4f4;
                                --root-button-color    :#dddddd;
                                --hover-button-color   :#d2d2d2;
                                --active-button-color  :#c0c0c0;
                                --week-color           :#55555555 !important;
                            }
                        </style>
                        <h1 style="margin-bottom: 76px; margin-top: 76px; text-align: center; font-size: 68px;">404</h1>
                        <h3 style="text-align: center;">Что случилось?<br>Кажется, вы попытались открыть страницу с таблицей, но что-то пошло не так...</h3>
                        <div style="display: flex; align-items: center; justify-content: center; flex-wrap: wrap; margin-top: 48px;">
                            <button style="height: 36px; width: 196px; margin: 8px; border: none; border-radius: 100px; cursor: pointer;" onclick="history.back(); sessionStorage.removeItem('errorPageLog'); sessionStorage.removeItem('errorPageError')">Вернуться назад</button>
                        </div>
                    `)
                } else {
                    plutonny.output('error', `
                        <h1 style="margin-bottom: 76px; margin-top: 76px; text-align: center;">Произошла критическая ошибка!</h1>
                        <h3 style="text-align: center;">Что случилось?<br>Сайт говорит нам неведомые "${sessionStorage.getItem('errorPageError')}"</h3>
                        <div style="display: flex; align-items: center; justify-content: center; flex-wrap: wrap; margin-top: 48px;">
                            <button style="height: 36px; width: 196px; margin: 8px; border: none; border-radius: 100px; cursor: pointer;" onclick="history.back(); sessionStorage.removeItem('errorPageError')">Вернуться назад</button>
                            <!--<button style="height: 36px; width: 148px; margin: 8px; border: none; border-radius: 100px; cursor: pointer;" onclick="location.assign('${link({type: 'HTML', file: 'support/?q=error'})}')">Поддержка</button>-->
                        </div>
                        <h3 style="text-align: center; margin-top: 48px;">Вы можете воспользоваться упрощенной страницей, на которой возникшей ошибки быть не должно</h3>
                        <div style="display: flex; align-items: center; justify-content: center; flex-wrap: wrap; margin-top: 26px; margin-bottom: 64px;">
                            <button style="height: 48px; width: 256px; margin: 8px; border: none; border-radius: 100px; cursor: pointer;" onclick="location.assign('${link({type: 'HTML', file: 'simple/'})}')">Перейти</button>
                        </div>
                        <h3 style="text-align: center; margin-top: 48px;">Для опытных пользователей: можно полностью сбросить настройки, это поможет, если проблема со стороны браузера (а проблема скорее всего именно со стороны браузера)</h3>
                        <div style="display: flex; align-items: center; justify-content: center; flex-wrap: wrap; margin-top: 12px; margin-bottom: 26px;">
                            <button style="height: 48px; width: 256px; margin: 8px; border: none; border-radius: 100px; cursor: pointer;" onclick="DELETEALL()">Сбросить настройки</button>
                        </div>
                        <div style="display: flex; align-items: center; justify-content: center; flex-wrap: wrap; margin-top: 26px; margin-bottom: 64px;">
                            <button style="height: 48px; width: 256px; margin: 8px; border: none; border-radius: 100px; cursor: pointer;" onclick="allInfoErrorModal(sessionStorage.getItem('errorPageError'))">Дополнительная информация</button>
                        </div>
                    `)
                }
            </script>
        </div>
    </body>
</html>